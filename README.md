# Домашнее задание к занятию «Компоненты Kubernetes» - Мельник Юрий Александрович

### Цель задания

Рассчитать требования к кластеру под проект

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания:

- [Considerations for large clusters](https://kubernetes.io/docs/setup/best-practices/cluster-large/),
- [Architecting Kubernetes clusters — choosing a worker node size](https://learnk8s.io/kubernetes-node-size).

------

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

----

 

## 1. Исходные данные по приложению (requests)

| Компонент  | Реплик | CPU/под | RAM/под | Итого CPU | Итого RAM |
|------------|:------:|:-------:|:-------:|:---------:|:---------:|
| База данных |   3    |  1 vCPU |  4 ГиБ  |     3     |     12    |
| Кэш         |   3    |  1 vCPU |  4 ГиБ  |     3     |     12    |
| Backend     |  10    |  1 vCPU | 0.6 ГиБ |    10     |      6    |
| Frontend    |   5    | 0.2 vCPU| 0.05 ГиБ|     1     |    0.25   |
| **Итого**   |        |         |         | **17**    | **30.25** |

**Суммарные requests:** **17 vCPU / 30.25 ГиБ**.

---

## 2. Отказоустойчивость по worker-нодам (минус 1 worker)

Берём **N = 5 worker-нод** одинаковой конфигурации.

Коэффициент для отказа одной worker-ноды:
\[
K = \frac{N}{N-1} = \frac{5}{4} = 1.25
\]

**Целевые ресурсы, которые должны выдержать оставшиеся 4 worker-ноды:**
- CPU: \(17 \times 1.25 = \) **21.25 vCPU**
- RAM: \(30.25 \times 1.25 = \) **37.81 ГиБ**

> Control plane не участвует в покрытии нагрузки приложения и считается отдельно.

---

## 3. Резервы на каждой **worker-н**оде

- **CPU-резерв:** −**10%** от CPU ноды  
- **RAM-резерв:** −**4 ГиБ** от RAM ноды

---

## 4. Подбор одинаковой конфигурации **worker**-нод и проверка «минус 1 нода»

**Выбранная конфигурация worker:** **5 × (6 vCPU, 16 ГиБ RAM)**

Эффективная ёмкость 1 worker-ноды для подов:
- CPU: \(6 \times 0.9 = \) **5.4 vCPU**
- RAM: \(16 - 4 = \) **12 ГиБ**

Проверка суммарной ёмкости:
| Сценарий         | CPU        | RAM    |
|------------------|:----------:|:------:|
| Все 5 workers    | 27.0 vCPU  | 60 ГиБ |
| Минус 1 worker   | 21.6 vCPU  | 48 ГиБ |

Сравнение с целями:
- Требуется **CPU ≥ 21.25** → имеем **21.6** 
- Требуется **RAM ≥ 37.81 ГиБ** → имеем **48 ГиБ**

> **Итого (workers):** одинаковые ноды 6 vCPU / 16 ГиБ выполняют требования с запасом.

---

## 5. Конфигурация **control plane** (отдельно от workers)

**3 × (2–4 vCPU, 8–16 ГиБ RAM, SSD/NVMe под etcd)**  
- Разворачиваются компоненты: etcd, kube-apiserver, scheduler, controller-manager.  
- Эти ноды не используются для нагрузки приложения.

---

## 6. Итоговая схема ролей и размеров

```text
            ┌───────────────────────────────┐
            │         Control Plane         │
            │   3× (2–4 vCPU, 8–16 ГиБ)     │
            │        SSD/NVMe для etcd      │
            └──────────────┬────────────────┘
                           │
      ┌────────────────────┴────────────────────┐
      │                 Workers                  │
      │     5× (6 vCPU, 16 ГиБ) — одинаковые     │
      │  Эффективно на поды: 5.4 vCPU / 12 ГиБ   │
      └──────────────────────────────────────────┘

---

### Правила приёма работы

1. Домашняя работа оформляется в своем Git-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Сначала сделайте расчёт всех необходимых ресурсов.
3. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
4. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды. 
5. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные. 
6. В результате должно быть указано количество нод и их параметры.

